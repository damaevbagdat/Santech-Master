# Настройка аналитики

На сайте настроены Google Analytics (GA4) и Яндекс.Метрика для отслеживания посещаемости.

## Google Analytics (GA4)

### 1. Создание счетчика

1. Перейдите на [Google Analytics](https://analytics.google.com)
2. Войдите с помощью Google аккаунта
3. Нажмите "Начать измерение"
4. Введите название аккаунта: "Santech-Master"
5. Создайте ресурс (Property):
   - Название ресурса: "santech-master.com"
   - Часовой пояс: GMT+6 (Алматы)
   - Валюта: KZT (Казахстанский тенге)
6. Добавьте веб-поток данных:
   - URL сайта: `https://santech-master.com`
   - Название потока: "Основной сайт"
7. Скопируйте **Идентификатор потока** (формат: `G-XXXXXXXXXX`)

### 2. Добавление на сайт

Создайте файл `.env` в корне проекта:

```bash
PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX  # Ваш реальный ID
PUBLIC_YANDEX_METRIKA_ID=12345678      # Ваш реальный ID
```

На сервере добавьте переменные окружения:

```bash
# На VPS
ssh ubuntu@194.32.142.237
cd /var/www/santech-master
nano .env

# Добавьте:
PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX
PUBLIC_YANDEX_METRIKA_ID=12345678

# Сохраните (Ctrl+O, Enter, Ctrl+X)
# Перезапустите сервер:
npm run build
pm2 restart santech-master
```

## Яндекс.Метрика

### 1. Создание счетчика

1. Перейдите на [Яндекс.Метрика](https://metrika.yandex.ru)
2. Войдите с помощью Яндекс аккаунта (или создайте новый)
3. Нажмите "Добавить счетчик"
4. Заполните форму:
   - Адрес сайта: `santech-master.com`
   - Категория: Услуги > Строительство и ремонт
   - Часовой пояс: GMT+6 (Алматы)
5. Настройки счетчика:
   - ✅ Вебвизор (запись сессий пользователей)
   - ✅ Карта кликов
   - ✅ Отслеживание хеша в URL
   - ✅ Точный показатель отказов
6. Скопируйте **Номер счетчика** (например: `98765432`)

### 2. Добавление на сайт

Добавьте ID в тот же файл `.env`:

```bash
PUBLIC_YANDEX_METRIKA_ID=98765432  # Ваш реальный ID
```

## Проверка работы

### Google Analytics

1. Откройте [Google Analytics](https://analytics.google.com)
2. Выберите ваш ресурс "santech-master.com"
3. Перейдите в "Отчеты" → "Реальное время"
4. Откройте сайт `https://santech-master.com` в другой вкладке
5. В течение 30 секунд вы должны увидеть активного пользователя

### Яндекс.Метрика

1. Откройте [Яндекс.Метрика](https://metrika.yandex.ru)
2. Выберите ваш счетчик
3. Проверьте статус установки кода (должна быть зеленая галочка)
4. Перейдите в "Посетители онлайн"
5. Откройте сайт в другой вкладке
6. Вы увидите себя в списке онлайн-посетителей

## Полезные отчеты

### Google Analytics

- **Посещаемость**: Отчеты → Аудитория → Обзор
- **География**: Отчеты → Аудитория → География → Местоположение
- **Источники трафика**: Отчеты → Привлечение → Обзор
- **Популярные страницы**: Отчеты → Вовлеченность → Страницы

### Яндекс.Метрика

- **Общая статистика**: Отчеты → Стандартные отчеты → Посещаемость
- **География**: Отчеты → Стандартные отчеты → География
- **Источники**: Отчеты → Стандартные отчеты → Источники → Сводка
- **Вебвизор**: Отчеты → Стандартные отчеты → Вебвизор (записи сессий)

## Конфиденциальность

Оба счетчика настроены с учетом приватности:

- **Google Analytics**:
  - Анонимизация IP (`anonymize_ip: true`)
  - Безопасные cookies (`SameSite=None;Secure`)

- **Яндекс.Метрика**:
  - Соответствие GDPR
  - Вебвизор с анонимизацией персональных данных

## Отладка

Проверить, загружаются ли скрипты аналитики:

```bash
# Откройте DevTools (F12) → Console
# Google Analytics
window.gtag  // Должно быть: ƒ gtag(){...}
dataLayer    // Должно быть: Array[...]

# Яндекс.Метрика
window.ym    // Должно быть: ƒ (t,n,i,r){...}
```
